<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0181)https://mail.google.com/mail/u/0/?ui=2&ik=7f046cef4c&view=pt&search=inbox&th=1528755c9cc9ea0c&siml=1528755c9cc9ea0c&siml=152f3861d614dce0&siml=152f4d7344723369&siml=152f4e8dc3f4c485 -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">
body,td,div,p,a,input {font-family: arial, sans-serif;}
</style><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Gmail - 5craft - задание</title><style type="text/css">
body, td {font-size:13px} a:link, a:active {color:#1155CC; text-decoration:none} a:hover {text-decoration:underline; cursor: pointer} a:visited{color:##6611CC} img{border:0px} pre { white-space: pre; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; word-wrap: break-word; max-width: 800px; overflow: auto;}
</style><style>div.ae5,
.Bu.y3,
.entry-author > .entry-likers,
.entry-actions > .like,
.entry-actions > .email,
.entry-actions > .broadcast-with-note,
.entry-actions > .broadcast,
.Bu + .Bu.yM + .Bu.y3,
#sub-tree-subscriptions,
#lhn-recommendations,
#lhn-friends,
div[style^="height: 16px; font: bold 12px/16px"],
[href^="http://pagead2.googlesyndication.com/"],
.z0DeRc,
.xz,
.u9,
.u4,
.rh > #ra,
.oM,
.nH.adC > .nH > .nH > .u5 > .azN,
.nH.PS,
.nH.MC,
.aeF > .nH > .nH[role="main"] > div + .mq,
.aeF > .nH > .nH[role="main"] > .nH > .nH > .nH > .mq:last-child,
.aeF > .nH > .nH[role="main"] > .nH > .nH > .AT[style],
.aeF > .nH > .nH[role="main"] > .mq:first-child,
.aeF > .nH > .nH[role="main"] > .afn:first-child + .mq,
.aeF > .nH > .nH[role="main"] > .aKB,
.aeF .nH[role="main"] > .mq:last-child,
.GISRH3UDHB,
.GGQPGYLCMCB,
.GGQPGYLCD5,
.GC3LC41DERB + div[style="position: relative; height: 170px;"],
#tadsc,
#ad,
#\:rr > .nH > div[role="main"] > .mq:last-child,
#\:rr > .nH > .nH[role="main"] > .nH > .nH > .AT[style],
#\:rr > .nH > .nH[role="main"] > .aKB,
#\:rr .nH[role="main"] .mq:first-child,
#center_col > #\5f Emc,
#center_col > #resultStats + #tads,
#center_col > #resultStats + #tads + #res + #tads,
#center_col > #resultStats + div + #res + #tads,
#center_col > #resultStats + div[style="border:1px solid #dedede;margin-bottom:11px;padding:5px 7px 5px 6px"],
#center_col > #taw > #tvcap > .rscontainer,
#center_col > div[style="font-size:14px;margin-right:0;min-height:5px"] > div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff8e7"],
#cnt #center_col > #res > #topstuff > .ts,
#main_col > #center_col div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff7ed"],
#mbEnd[cellspacing="0"][cellpadding="0"],
#mclip_container:last-child,
#mn #center_col > div > h2.spon:first-child,
#mn #center_col > div > h2.spon:first-child + ol:last-child,
#resultspanel > #topads,
#rhs_block > #mbEnd,
#rhs_block > .ts[cellspacing="0"][cellpadding="0"][style="padding:0"],
#rhswrapper > #rhssection[border="0"][bgcolor="#ffffff"],
#ssmiwdiv[jsdisplay],
#tads + div + .c,
#tads.c,
#tadsb.c,
#tadsto.c,
#topstuff > #tads,
.GB3L-QEDGY .GB3L-QEDF- > .GB3L-QEDE-,
.GFYY1SVD2 > .GFYY1SVC2 > .GFYY1SVF5,
.GFYY1SVE2 > .GFYY1SVD2 > .GFYY1SVG5,
.GHOFUQ5BG2 > .GHOFUQ5BF2 > .GHOFUQ5BG5,
.GJJKPX2N1 > .GJJKPX2M1 > .GJJKPX2P4,
.GKJYXHBF2 > .GKJYXHBE2 > .GKJYXHBH5,
.GPMV2XEDA2 > .GPMV2XEDP1 > .GPMV2XEDJBB,
.ch[onclick="ga(this,event)"],
.commercial-unit-desktop-rhs,
.commercial-unit-desktop-top,
.lads[width="100%"][style="background:#FFF8DD"],
.mod > ._jH + .rscontainer,
.mw > #rcnt > #center_col > #taw > #tvcap > .c,
.mw > #rcnt > #center_col > #taw > .c,
.ra[align="left"][width="30%"],
.ra[align="right"][width="30%"],
.ra[width="30%"][align="right"] + table[width="70%"][cellpadding="0"],
.rhsvw[style="background-color:#fff;margin:0 0 14px;padding-bottom:1px;padding-top:1px;"],
.rscontainer > .ellip,
#sqh,
#center_col > #tads,
[href^="https://plus.google.com/share?url="],
[href^="http://www.google.com/aclk?"],
#gb[style="min-width: 980px;"] > .gb_wb,
.fb.icon
{display:none !important;}</style><style>iframe[src="https://clients5.google.com/ads/measurement/jn/?hd=mail.google.com"],
iframe[src="https://clients5.google.com/pagead/drt/dn/"]
{display:none !important;}</style></head><body><div class="bodycontainer"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr height="14px"><td width="143"><img src="./5craft_files/logo.gif" width="143" height="59" alt="Gmail"></td><td align="right"><font size="-1" color="#777"><b>Smart Phone &lt;w732qq@gmail.com&gt;</b></font></td></tr></tbody></table><hr><div class="maincontent"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><font size="+1"><b>5craft - задание</b></font><br><font size="-1" color="#777">Писем: 43</font></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">28 января 2016 г., 11:24</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: w732qq@gmail.com</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Привет!<div><br><div>&nbsp;Вот такое есть задание. <a href="https://docs.google.com/document/d/1xJGodOaa3D9a29xKEfFOopXZ03Ew8W8Dx38zZ7vRbpE/edit" target="_blank">https://docs.google.com/<wbr>document/d/<wbr>1xJGodOaa3D9a29xKEfFOopXZ03Ew8<wbr>W8Dx38zZ7vRbpE/edit</a> Здесь описан APNS-сервис для iOS - девайсами и эппловым APNS-сервером. Это компонент системы доставки пуш-нотификаций на девайсы пользователей. Нужна точно такая же штука для андроид-девайсов в соответсвии со спецификой их механизма пушей.&nbsp;</div><div><br></div><div>&nbsp;Формат файла задачи для андроида вот такой будет, первую версию формата поддерживать не обязательно.</div><div><a href="https://docs.google.com/document/d/1fbydvTsUAE9aw8u5_wbxwxQ5Df482B8SUeQj-ukMEdk/edit?usp=sharing" target="_blank">https://docs.google.com/<wbr>document/d/1fbydvTsUAE9aw8u5_<wbr>wbxwxQ5Df482B8SUeQj-ukMEdk/<wbr>edit?usp=sharing</a><br></div><div><br></div><div>&nbsp;Прежде всего от тебя понадобятся примерные сроки, цена и технологии реализации (базовые фреймворки/библиотеки/их отсутствие и язык разработки).</div></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">28 января 2016 г., 11:26</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Задание получил, ознакомлюсь сегодня-завтра, думаю, к вечеру пятницы дам ответ.</div><div class="gmail_extra"><br><div class="gmail_quote">28 января 2016 г., 11:24 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">29 января 2016 г., 18:58</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Посмотрел задание.<div><br></div><div>Мысли следующие: язык разработки - Python, примерные сроки - 2 недели, цена - 9 000 рублей. Для питона есть несколько библиотек, реализующих работу с APNs, какую-то конкретную пока не выбрал.</div></div><div class="gmail_extra"><br><div class="gmail_quote">28 января 2016 г., 11:26 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 1:21</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div style="white-space:pre-wrap">Ок, звучит адекватно. Прежде чем начнём кинь все же ссылок на библиотеки, что нашёл для работы.</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 14:22</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Да, собственно, намереваюсь обойтись стандартной библиотекой. Для многопоточности планирую использовать либо threading, либо multiprocessing.dummy. <a href="https://github.com/thesharp/daemonize" target="_blank">https://github.com/thesharp/<wbr>daemonize</a>, чтобы сделать из приложения линуксовый демон. А вот с APNs библиотекой ещё не определился. Раньше не приходилось ни с чем подобным работать, по этому так просто взять и выбрать не могу. Попробую одну, не понравится - попробую другую. Ещё есть вопрос, аналог APNs для устройств android, это GCM? <a href="https://developers.google.com/cloud-messaging/gcm" target="_blank">https://developers.google.com/<wbr>cloud-messaging/gcm</a> Если да, то мне следует искать библиотеку для него?&nbsp;</div><div class="gmail_extra"><br><div class="gmail_quote">1 февраля 2016 г., 1:21 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 14:57</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">&nbsp;Ага, GCM. И для него было бы круто использовать для работы с ним уже что-то готовое, чтобы багов было меньше.<div><br></div><div>&nbsp;В итоге - да, начинаем. Когда примерно ждем первую версию?<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 15:13</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">К концу недели, думаю, что-то уже будет.</div><div class="gmail_extra"><br><div class="gmail_quote">1 февраля 2016 г., 14:57 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 18:20</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">ага, клеви. Ждем тогда</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">1 февраля 2016 г., 23:54</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Есть вопрос по формату файлов задач. Конкретно, как будут выглядеть шаблоны пушей? Можешь скинуть настоящий файл?&nbsp;</div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">2 февраля 2016 г., 0:47</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">для андроида сейчас нет файла, вот пример файла для iOS по тому формату, что описан&nbsp;<a href="http://bnet-team.ru/x2/task.txt" target="_blank">http://bnet-team.ru/x2/<wbr>task.txt</a>&nbsp;.&nbsp;</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">7 февраля 2016 г., 13:25</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Привет! Добил сегодня версию, стремящуюся к 0.0.1 :)&nbsp;<a href="https://bitbucket.org/_burn/apnsd" target="_blank">https://bitbucket.org/_<wbr>burn/apnsd</a>. Репозиторий приватный, мне его сделать публичным, или дать доступ кому надо?</div><div class="gmail_extra"><br><div class="gmail_quote">2 февраля 2016 г., 0:47 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<font color="#550055"><br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">для андроида сейчас нет файла, вот пример файла для iOS по тому формату, что описан&nbsp;<a href="http://bnet-team.ru/x2/task.txt" target="_blank">http://bnet-team.ru/x2/<wbr>task.txt</a>&nbsp;.&nbsp;</div><div><div><br><div class="gmail_quote"><div dir="ltr">On Mon, Feb 1, 2016 at 11:54 PM Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt; wrote:<br></div><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">Есть вопрос по формату файлов задач. Конкретно, как будут выглядеть шаблоны пушей? Можешь скинуть настоящий файл?&nbsp;</div>
</blockquote></div>
</div></div></blockquote></font></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">7 февраля 2016 г., 15:18</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">привет! супер!<div>&nbsp;публичным не надо) Пошарь пользователям&nbsp;x2xert и konjahin . Глянем в понедельник</div></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">8 февраля 2016 г., 14:57</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">ну почти разобрались)&nbsp;<div>1. Расскажи как запустить и что есть из процесса обработки таска - там сейчас в конфиге пустые директории. Как в общем заставить его пуш отослать?<div>2. Еще волнует вопрос про api_key в конфиге - это ключ от чего должен быть?</div><div>3. Не удаляй людей из копии, пользуй "ответить всем"</div></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">8 февраля 2016 г., 15:46</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">1. Это пока только прототип. Работает отправка пуша, не работает: перемещение файла задачи по окончанию обработки в нужную директорию, логгирования нет совсем, запись успешных отправок в БД. Сейчас как раз делаю непосредственно т.н "бинарник", исполняемый файл, который будет всё запускать. А сейчас его можно заставить отослать пуш так: в конфиг прописать директорию (либо относительный путь от директории, из которой будете запускать, либо абсолютный путь), положить в эту директорию файл таска, написать простейший скрипт&nbsp;<a href="http://pastebin.com/0MMr2V4z" target="_blank">http://pastebin.com/<wbr>0MMr2V4z</a>, запустить этот скрипт (либо запустить интерпретатор, и вручную заимпортить и запуситить, как в скрипте). Но: 1) скорее всего ничего не заработает, потому что формат токенов девайсов у APNs и GCM разный, и они не будут спарсены из файла задачи; 2) см. следующий пункт.<div><br></div><div>2. API key, на сколько я смог понять, это ключ, который ты получаешь в консоли девелопера для своего приложения. Enable Google Services -&gt; Google Cloud Messaging&nbsp;<a href="https://developers.google.com/mobile/add" target="_blank">https://developers.<wbr>google.com/mobile/add</a></div><div><br></div><div>Есть ряд вопросов, вечером пришлю, когда окончательно проясню некоторые моменты.</div></div><div class="gmail_extra"><br><div class="gmail_quote">8 февраля 2016 г., 14:57 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">8 февраля 2016 г., 16:39</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Ок, понимат. Увидел два момента<div>1. Файл задачи - он в задании был в формате для эппл-сервиса. В андроиде нужны логичные изменения, в том числе в формате даты, что отправляется на сервер. Например жсон { aps: ... } - это из документации эппла <a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/TheNotificationPayload.html#//apple_ref/doc/uid/TP40008194-CH107-SW2" target="_blank">https://developer.apple.com/<wbr>library/ios/documentation/<wbr>NetworkingInternet/Conceptual/<wbr>RemoteNotificationsPG/<wbr>Chapters/<wbr>TheNotificationPayload.html#//<wbr>apple_ref/doc/uid/TP40008194-<wbr>CH107-SW2</a> , в андроиде там наверняка что-то другое должно быть в пейлоаде - напиши в каком формате туда что нужно передавать<br><div>2. Ключ из конфига нужно будет перетащить в файл задачи - это по сути аналог сертификата с паролем из эпплового сервиса.&nbsp;</div><div>&nbsp;</div><div>Других расхождений в форматах на первый взгляд не вижу, но если понядобятся - конечно же вноси.</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">11 февраля 2016 г., 22:18</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Зарелизил версию 0.0.1beta<br><br>Что есть: логгирование, интеграция с systemd (пришёл к выводу, что так гораздо проще, чем демонизировать само приложение)<div>Чего нет: запись успешных задач в бд</div><div><br></div><div>Что нужно сделать: немного подразобраться с GCM, как там что работает, согласовать формат задачь, ну и собственно, попробовать поотправлять пуши в какое-нибудь приложение.</div></div><div class="gmail_extra"><br><div class="gmail_quote">8 февраля 2016 г., 16:39 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">11 февраля 2016 г., 22:53</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">крутяк. Давай пользовать формат тот же, что и в айосной версии. Вместо сертификата с паролем засунем туда api-ключ, а для пейлоада расскажи какой формат нужен.<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">14 февраля 2016 г., 17:11</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Зарелизил версию 0.0.2b, удовлетворяющую требованиям поставленной задачи. Формат файла задачи:&nbsp;<a href="https://bitbucket.org/_burn/apnsd/raw/30f526c69ee4f55a86b052bf3c2d30c2ec15a2b2/android-task.txt" target="_blank">https://bitbucket.org/<wbr>_burn/apnsd/raw/<wbr>30f526c69ee4f55a86b052bf3c2d30<wbr>c2ec15a2b2/android-task.txt</a>. Пример json'а пейлоада:&nbsp;<a href="https://bitbucket.org/_burn/apnsd/raw/30f526c69ee4f55a86b052bf3c2d30c2ec15a2b2/gcm-message-example.json" target="_blank">https://bitbucket.<wbr>org/_burn/apnsd/raw/<wbr>30f526c69ee4f55a86b052bf3c2d30<wbr>c2ec15a2b2/gcm-message-<wbr>example.json</a></div><div class="gmail_extra"><br><div class="gmail_quote">11 февраля 2016 г., 22:53 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 9:31</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Отлично, спасибо! Сегодня протестим</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Anton Konjahin </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 12:34</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;</div><div>Копия: Smart Phone &lt;w732qq@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1">Привет!<div>Тестируем сейчас приложение, возникло несколько вопросов.</div><div>Пытаюсь составить корректный таск, ориентируюсь на этот пример: <a href="https://bitbucket.org/_burn/apnsd/raw/30f526c69ee4f55a86b052bf3c2d30c2ec15a2b2/android-task.txt" target="_blank">https://bitbucket.org/_burn/<wbr>apnsd/raw/<wbr>30f526c69ee4f55a86b052bf3c2d30<wbr>c2ec15a2b2/android-task.txt</a></div><div>Что нужно подставить в поле sender_id?&nbsp;</div><div>Я заменил api_key, добавил токен реального девайса, однако, получаю вот такую ошибку: <a href="http://pastebin.com/DZKwkXgk" target="_blank">http://pastebin.com/DZKwkXgk</a></div><div>Там нужен какой-то особый формат? Я сделал так:</div><div><div>###</div><div>cMeATyVtST8:<wbr>APA91bGlsHpTRJkthF-<wbr>kc3WFgN0juOvVPv1rxfabVuBRHGwWy<wbr>lhHMwiZioECWleNpq6TC-<wbr>g9VMfeJbICCqBRYOkqeDlbCfs3L_<wbr>rQmUseGBfpPjj7kX2IqD6dxYDhgCFX<wbr>1ibbzMsyhw2o</div><div><br></div><div>После токена - пустая строка.</div><br>В Понедельник, 15 фев. 2016 в 9:31 , x2 &lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt; написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 13:01</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Anton Konjahin &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">А что у вас было поле sender_id в случае с iOS? Я так понял, это какой-то идентификатор приложения? Можно сейчас туда поставить Project Number из панели разработчика Google.<div><br></div><div>Для api_key надо изменить регулярку, которой он парсится,&nbsp;<a href="https://bitbucket.org/_burn/apnsd/src/30f526c69ee4f55a86b052bf3c2d30c2ec15a2b2/apnsd/apns_task.py?at=master&amp;fileviewer=file-view-default#apns_task.py-143" target="_blank">https://bitbucket.<wbr>org/_burn/apnsd/src/<wbr>30f526c69ee4f55a86b052bf3c2d30<wbr>c2ec15a2b2/apnsd/apns_task.py?<wbr>at=master&amp;fileviewer=file-<wbr>view-default#apns_task.py-143</a> так как регулярка была написана для формата токенов iOS-устройств, а для андроида он совсем другой. Я её (регулярочку) сразу не мог написать, так как мне негде было посмотреть настоящий андроидовский токен, и гугление результата не дало. Думаю, такая регулярка подойдёт: [-a-zA-Z_:\d]{152}. Пустую строку после токена не надо, они должны идти один за другим, построчно, иначе не спарсятся.</div></div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 12:34 пользователь Anton Konjahin <span dir="ltr">&lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 13:05</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Anton Konjahin &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr"><span style="font-size:12.8px">Блин, я имел ввиду не api_key, а токен девайса, с api_key всё должно быть в порядке.</span><br></div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 13:01 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 15:03</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Anton Konjahin &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Как проходит тестирование?</div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 13:05 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 16:20</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr"><div>Мне удалось отправить пуш на устройство. Однако, есть пара моментов, требующих разъяснений.</div><div><br></div><div><a href="https://bitbucket.org/_burn/apnsd/src/30f526c69ee4f55a86b052bf3c2d30c2ec15a2b2/apnsd/apns_task.py?at=master&amp;fileviewer=file-view-default#apns_task.py-127" target="_blank">В этой строке</a>, если сервер возвращает ошибку,&nbsp; failed представляет собой вот такой объект:<br> {'fVnTxXhH9nc:<wbr>APA91bFAUiU9gUh5oNmSAShLkymo1k<wbr>uR0jktXALMVzaa_<wbr>DrLHzpNyZ9ptC9dllMYtx5yUZCu5m9<wbr>t8mKr6cXv-f6x2_<wbr>WQaX0x1ksGiyNXEnOs8voClx2wf4Tf<wbr>M8SsP4mhldHhp8540JbJ': 'InvalidPackageName'}.&nbsp; И я получаю: ValueError: too many values to unpack (expected 2). <br><br>В примере файла-задачи для пушей вы используете разнообразные опции, такие как<font color="#000000" face="Sans" size="3"><span style="line-height:normal">&nbsp;</span></font><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap">dry_run, </span><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap">collapse_key и другие. Пуш посылается только если их удалить. </span><br></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap"><br></span></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap">Когда я пытаюсь запустить сервер как демон через systemd (версия 222) то он просто не запускался безо всяких сообщений в логах. Запуск напрямую работает нормально. Возможно, это какие-то локальные проблемы, прошу вас посмотреть, пишет ли программа при неудачном запуске что-нибудь куда-нибудь.</span></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap"><br></span></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap">Если положить в директорию inbox два файла с задачами, один из которых испорчен (например, указан неверный package name), то оба будут перемещены в директорию sent безо всяких сообщений об ошибках. Если посылать только испорченный таск, то ошибка есть (её пример я приводил выше).</span></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap"><br></span></div><div><span style="color:rgb(0,0,0);line-height:normal;white-space:pre-wrap">Я прикладываю к этому письму пример таска, который успешно отсылает пуш и apk файл приложения, которое позволит вам протестировать работу скрипта (если у вас есть андроид устройство). Всё, что вам нужно - запустить приложение и изменить токен из файла на тот, который будет закреплён за вашим устройством. Токен будет выведен после запуска, копирование/вставка с экрана должны работать. Если что-то не получится - пишите, будем разбираться.</span></div><div><br><br>В Понедельник, 15 фев. 2016 в 3:03 , Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt; написал:</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div><br clear="all"><div style="width:50%;border-top:2px #AAAAAA solid"></div><table class="att" cellspacing="0" cellpadding="5" border="0"><tbody><tr><td colspan="2"><b style="padding-left:3">Приложений: 2</b></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tbody><tr><td><a target="_blank" href="https://mail.google.com/mail/u/0/?ui=2&amp;ik=7f046cef4c&amp;view=att&amp;th=152e516a6f91185c&amp;attid=0.1&amp;disp=attd&amp;realattid=152e511d3423644921&amp;safe=1&amp;zw"><img width="16" height="16" src="./5craft_files/generic.gif"></a></td><td width="7"></td><td><b>test</b><br>1K </td></tr></tbody></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tbody><tr><td><a target="_blank" href="https://mail.google.com/mail/u/0/?ui=2&amp;ik=7f046cef4c&amp;view=att&amp;th=152e516a6f91185c&amp;attid=0.2&amp;disp=attd&amp;realattid=152e512441fc6727f552&amp;safe=1&amp;zw"><img width="16" height="16" src="./5craft_files/generic.gif"></a></td><td width="7"></td><td><b>app-debug.apk</b><br>2014K </td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 16:49</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">По параграфам:<div><br></div><div>1. Пофиксил, забыл вызвать .items() на dict()</div><div><br></div><div>2. Все опции являются опциональными (sic!), сервера гугла принимают параметр dry_run, если он получен, то фактическая отправка пуша на устройства не производится. Думаю, именно из-за этого пуш не отсылался.</div><div><br></div><div>3. Демонизация с помощью systemd работает так, пишешь обычное приложение, логи пишешь в stderr, при запуске как демон, systemd их пересылает в syslog. Сейчас дефолтный log-level выставлен в INFO, так что программа довольно информативно пишет как при удачном, так и при неудачном запуске. Чтобы посмотреть, что там пишет программа, нужно просто заглянуть в syslog: $ tail -f /var/log/syslog.&nbsp;</div><div><br></div><div>4, 5. Надо разбираться, вечером займусь.</div><div><br></div><div>P. S. За приложение огромное спасибо.</div></div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 16:20 пользователь Антон Коняхин <span dir="ltr">&lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 16:52</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">P. P. S. Фикс в мастер не мержил, берите из develop'а</div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 16:49 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">15 февраля 2016 г., 22:52</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr"><div>Затеститл, результаты следующие:</div><font color="#550055"><div><br></div>&gt;&nbsp;<span style="color:rgb(0,0,0);font-size:12.8px;white-space:pre-wrap">Если положить в директорию inbox два файла с задачами, один из которых испорчен (например, указан неверный package name), то оба будут перемещены в директорию sent безо всяких сообщений об ошибках. Если посылать только испорченный таск, то ошибка есть (её пример я приводил выше).</span><div><span style="color:rgb(0,0,0);font-size:12.8px;white-space:pre-wrap"><br></span></div></font><div><span style="color:rgb(0,0,0);font-size:12.8px;white-space:pre-wrap">По условиям задачи, в директорию failed нужно складывать только те задачи, которые не удалось спарсить. Указан неверный package name - это не случай испорченного файла. В этом случае попытка отправки происходить, но сервер отвечает ошибкой, которая пишется в лог в директории %logs%, опять же, как и предписывают условия поставленной задачи. Ошибка ValueError возникала из-за моей невнимательности, её я уже пофиксил.</span></div><div><span style="color:rgb(0,0,0);font-size:12.8px;white-space:pre-wrap"><br></span></div><div><span style="color:rgb(0,0,0);font-size:12.8px;white-space:pre-wrap">Зарелизил версию 0.0.3b, с исправленным форматом токенов девайсов.</span></div></div><div class="gmail_extra"><br><div class="gmail_quote">15 февраля 2016 г., 16:52 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">16 февраля 2016 г., 14:25</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;, Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">привет, посмотрели локально, выглядит ок. попробуем на живом сегодня.&nbsp;<div><br></div><div>Не понял только со сфейленной задачей - в таске не про парсинг, а про обработчик который скрашится может по любой другой причине, не обязательно из-за парсинга. Второй момент - что произойдет если в середине отправки задачи андроидов сервер отвалится из-за, например, разрыва соединения?</div></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 11:51</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: x2 &lt;x2xert@gmail.com&gt;, Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Добрый день.<div>Потестировали программу на сервере, столкнулись с некоторыми трудностями. Прикладываю пример таска (test_2), который не удалось распарсить.&nbsp;</div><div>На сервере мы получаем такую ошибку:</div><div><br></div><div><div>Exception in thread TaskProcessor-0:</div><div>Traceback (most recent call last):</div><div>&nbsp; File "/usr/lib/python3.2/threading.<wbr>py", line 740, in _bootstrap_inner</div><div>&nbsp; &nbsp; self.run()</div><div>&nbsp; File "/usr/local/lib/python3.2/<wbr>dist-packages/apnsd/worker.py"<wbr>, line 73, in run</div><div>&nbsp; &nbsp; task.process()</div><div>&nbsp; File "/usr/local/lib/python3.2/<wbr>dist-packages/apnsd/apns_task.<wbr>py", line 38, in process</div><div>&nbsp; &nbsp; message = JSONMessage(task.tokens, data, **options)</div><div>&nbsp; File "/usr/local/lib/python3.2/<wbr>dist-packages/apnsd/packages/<wbr>gcmclient/gcm.py", line 123, in __init__</div><div>&nbsp; &nbsp; raise ValueError("Empty registration_ids list")</div><div>ValueError: Empty registration_ids list</div></div><div><br></div><div>Любопытно, что такой же файл локально (Python 3.4.3) даёт:</div><div><br></div><div><div>WARNING:2016-02-17 11:43:27,747:apnsd.worker:<wbr>TaskProcessor-0:Can not parse task file "test_2": Expected MESSAGE_START</div></div><div><br></div><div>Прошу вас посмотреть на оба приложенных примера, проблема в формате или она в чём-то ещё. И нельзя ли сделать ошибки и предупреждения о проблемах с парсингом более информативными? Expected MESSAGE_START это хорошо, но непонятно ни строка, ни что скрипт ожидал на ней, ни что получил.</div><div><br></div><br><div class="gmail_quote"><div dir="ltr">вт, 16 февр. 2016 г. в 14:26, x2 &lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;:<br></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div></div>
</font></div><br clear="all"><div style="width:50%;border-top:2px #AAAAAA solid"></div><table class="att" cellspacing="0" cellpadding="5" border="0"><tbody><tr><td colspan="2"><b style="padding-left:3">Приложений: 2</b></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tbody><tr><td><a target="_blank" href="https://mail.google.com/mail/u/0/?ui=2&amp;ik=7f046cef4c&amp;view=att&amp;th=152ee6de1a57f3fb&amp;attid=0.1&amp;disp=attd&amp;realattid=152ee672ffecbb773c51&amp;safe=1&amp;zw"><img width="16" height="16" src="./5craft_files/generic.gif"></a></td><td width="7"></td><td><b>test_2</b><br>1K </td></tr></tbody></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tbody><tr><td><a target="_blank" href="https://mail.google.com/mail/u/0/?ui=2&amp;ik=7f046cef4c&amp;view=att&amp;th=152ee6de1a57f3fb&amp;attid=0.2&amp;disp=attd&amp;realattid=152ee6b39f5cbb773c62&amp;safe=1&amp;zw"><img width="16" height="16" src="./5craft_files/generic.gif"></a></td><td width="7"></td><td><b>test_3</b><br>1K </td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 12:38</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Бегло глянул, более детально сейчас к сожалению не могу.<div><br></div><div>Ошибку ValueError мне смоделировать не удалось.</div><font color="#550055"><div><br></div><div><span style="font-size:12.8px">&gt; WARNING:2016-02-17 11:43:27,747:apnsd.worker:</span><span style="font-size:12.8px">Task<wbr>Processor-0:Can not parse task file "test_2": Expected MESSAGE_START</span><br></div><div><span style="font-size:12.8px"><br></span></div></font><div><span style="font-size:12.8px">Давится лишней пустой строкой в конце файла.&nbsp;</span></div><div><span style="font-size:12.8px"><br></span></div><div><span style="font-size:12.8px">А что с test_3? У меня он обрабатывается нормально.</span></div></div><div class="gmail_extra"><br><div class="gmail_quote">17 февраля 2016 г., 11:51 пользователь Антон Коняхин <span dir="ltr">&lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 12:44</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">ОК, подождём более детального анализа. test_3 тоже падал с ValueError. Вам нужна какая-то доп. информация для воспроизведения? Версия питона была в стректрейсе, может версии каких библиотек предоставить? Нам нужно понять, почему на сервере парсинг проходит не так, как ожидается. Возможно, есть смысл погонять там версию програмы с логирующим выводом, либо что-то подобное.</div><br><div class="gmail_quote"><div dir="ltr">ср, 17 февр. 2016 г. в 12:38, Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;:<br></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 12:57</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><p>Подумал немного, вот что придумал: похоже, токены вообще не парсятся. На сервере точно последняя версия, с исправленным регулярным выражением для токена? </p>
<div class="gmail_quote">17.02.2016 12:44 пользователь "Антон Коняхин" &lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt; написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 13:14</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;, x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1">Заливал новую, регулярку смотрел глазами, думал о таком. Кстати, о регулярках. Как мне сказали, длина токенов может варьироваться в широком пределе. До 255 символов, примерно. Возможно, стоит сделать регулярку более всеядной? И нельзя ли выводить в лог те строки, которые ни с чем не совпали? Так будет проще детектить проблемы.<br><br><div class="gmail_quote"><div dir="ltr">ср, 17 февр. 2016 г., 12:57,&nbsp;Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;:<br></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 15:32</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Да, регулярочка однозначно требует уточнения, так как я не знаю точный формат токенов. Если есть достоверная информация об этом, было бы здорово её узнать. На счёт вывода дополнительно инфы и подробных сообщений - вечером займусь.</div><div class="gmail_extra"><br><div class="gmail_quote">17 февраля 2016 г., 13:14 пользователь Антон Коняхин <span dir="ltr">&lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 15:37</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Разработчик из гугла утверждает, что их размер может вырасти до 4K:&nbsp;<a href="https://groups.google.com/forum/#!msg/android-gcm/q2PzJTP71TY/DNX4lvDu5X4J" target="_blank">https://groups.google.com/<wbr>forum/#!msg/android-gcm/<wbr>q2PzJTP71TY/DNX4lvDu5X4J</a>&nbsp;В отдалённой перспективе. Так что длину проверять не стоит, возможно лучше будет просто бить их по символу переноса строки. С символами то вроде уже всё хорошо. По остальному - ок, ждём.</div><br><div class="gmail_quote"><div dir="ltr">ср, 17 февр. 2016 г. в 15:32, Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;:<br></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 20:03</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr"><div>Воспроизвести ошибку ValueError мне так и не удалось. Точно понятно, что она возникает из-за того, что не парсится ни одного токена. А вот почему они не парсятся -&nbsp;<span style="color:rgb(44,45,48);font-family:Slack-Lato,appleLogo,sans-serif;font-size:15px;line-height:22px;background-color:rgb(249,249,249)">¯\_(ツ)_/¯</span></div><div><br></div>Добавил более информативное сообщение об ошибке парсинга. Ещё теперь ожидается как минимум один токен устройства, так что теперь парсинг должен свалиться, если не нашёл ни одного токена, и исключение ValueError не бросится.<div><br></div><div>В master не мержил, в develop'е.</div></div><div class="gmail_extra"><br><div class="gmail_quote">17 февраля 2016 г., 15:37 пользователь Антон Коняхин <span dir="ltr">&lt;<a href="mailto:drugros68@gmail.com" target="_blank">drugros68@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">17 февраля 2016 г., 20:20</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Ещё, если можно, вывод этого скрипта&nbsp;<a href="http://pastebin.com/UVh9Zssu" target="_blank">http://pastebin.com/<wbr>UVh9Zssu</a> с файлом, который вызывает ошибку, в качестве параметра: $ script test_2 (типа того)</div><div class="gmail_extra"><br><div class="gmail_quote">17 февраля 2016 г., 20:03 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 0:24</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Этого скрипта:&nbsp;<a href="http://pastebin.com/zQXcYcPw" target="_blank">http://pastebin.com/<wbr>zQXcYcPw</a>, предыдущая ссылка не правильная.</div><div class="gmail_extra"><br><div class="gmail_quote">17 февраля 2016 г., 20:20 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 11:33</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Привет! Есть продвижение?</div><div class="gmail_extra"><br><div class="gmail_quote">18 февраля 2016 г., 0:24 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Oleg Kapitonov </b>&lt;angelbnet@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 11:36</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Антон Коняхин &lt;drugros68@gmail.com&gt;, x2 &lt;x2xert@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Я конечно со стороны наблюдаю, но давай мы как нибудь сами разберемся с приоритетами наших задач, торопить будешь своих подчиненных.&nbsp;</div><div class="gmail_extra"><br><div class="gmail_quote">18 февраля 2016 г., 11:33 пользователь Smart Phone <span dir="ltr">&lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><font color="#888888"><br><br clear="all"><div><br></div>-- <br><div><div dir="ltr"><div><div dir="ltr">Regards, Oleg Kapitonov.<br>CEO — <a href="http://smorodina.mobi/" target="_blank">http://smorodina.mobi</a> [Разработка отличных мобильных приложений]<br>+79051211592<br>skype:bnetteam<br><br><br></div></div></div></div>
</font></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Антон Коняхин </b>&lt;drugros68@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 17:44</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: x2 &lt;x2xert@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Добрый вечер.<div>Потестировали на серверах. Проблема с парсингом токенов ушла, однако, появилось несколько новых:</div><div><br></div><div><div>1. Юникод в тасках вызывает ошибку.</div><div>WARNING:2016-02-18 12:44:14,855:apnsd.worker:<wbr>TaskProcessor-0:An unexpected error occurred in thread "TaskProcessor-0" while processing task "/var/www/APNSD/files/inbox/<wbr>anton_key.txt": 'ascii' codec can't decode byte 0xe7 in position 354: ordinal not in range(128)</div><div><br></div><div>2. После предыдущей ошибки файл таска остался в inbox, в директории с логами было пусто. В случае любой неожиданной проблемы, не только парсинга юникода, следует таск класть в failed, а в логах создавать файл с сообщением о том, что пошло не так.</div><div><br></div><div>3. Если формат не удалось распарсить, таск перемещается в failed, но в логах опять пусто.</div><div><br></div><div>4. Прошу вас проверить обработку ошибок, возвращаемых гугловским сервером. Все неудачные запросы должны логироваться (в директорию logs), а таски для них - перемещаться в fail. Сейчас таск молча уходит в sent.</div><br><div class="gmail_quote"><div dir="ltr">чт, 18 февр. 2016 г. в 11:33, Smart Phone &lt;<a href="mailto:w732qq@gmail.com" target="_blank">w732qq@gmail.com</a>&gt;:<br></div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div></div></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>x2 </b>&lt;x2xert@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 18:03</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Кому: Антон Коняхин &lt;drugros68@gmail.com&gt;, Smart Phone &lt;w732qq@gmail.com&gt;</div><div>Копия: Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">по 4 пункту - все ошибки от гугла в logs в любом случае, а вот файл с задачей в sent если удалось отослать хотя бы один пуш. Если ошибка была на все токены из файла - в fail.</div><div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></font></div></td></tr></tbody></table></td></tr></tbody></table><hr><table width="100%" cellpadding="0" cellspacing="0" border="0" class="message"><tbody><tr><td><font size="-1"><b>Smart Phone </b>&lt;w732qq@gmail.com&gt;</font></td><td align="right"><font size="-1">18 февраля 2016 г., 18:27</font></td></tr><tr><td colspan="2"><font size="-1" class="recipient"><div>Черновик "Кому": x2 &lt;x2xert@gmail.com&gt;</div><div>Копия: Антон Коняхин &lt;drugros68@gmail.com&gt;, Kapitonov Oleg &lt;angelbnet@gmail.com&gt;</div></font></td></tr><tr><td colspan="2"><table width="100%" cellpadding="12" cellspacing="0" border="0"><tbody><tr><td><div style="overflow: hidden;"><font size="-1"><div dir="ltr">Делал, как написано тут&nbsp;<a href="https://docs.google.com/document/d/1xJGodOaa3D9a29xKEfFOopXZ03Ew8W8Dx38zZ7vRbpE/edit" target="_blank">https://docs.google.com/<wbr>document/d/<wbr>1xJGodOaa3D9a29xKEfFOopXZ03Ew8<wbr>W8Dx38zZ7vRbpE/edit</a> (1)<div><br></div><div>1. Исправлю</div><div><br></div><div>2.</div><div>&gt;&nbsp;<span style="font-size:12.8px">После предыдущей ошибки файл таска остался в inbox.&nbsp;</span><span style="font-size:12.8px">В случае любой неожиданной проблемы, не только парсинга юникода, следует таск класть в failed</span><span style="font-size:12.8px"><br></span>Исправлю.</div><div><br></div>Цитата из (1): "Отправка пользователям с ошибками повторяется M раз. После этого все неудавшиеся токены с ошибкой пишутся в лог". Так вот: о создании лог-файлов при таких ошибках в задаче речи не шло, а сообщение о том, что пошло не так итак логгируетя - в syslog (или в stderr).<div><br></div><div>3. См. предыдущий пункт.</div><div><br></div><div>4.&nbsp;</div><font color="#550055"><div>&gt;&nbsp;<span style="font-size:12.8px">Все неудачные запросы должны логироваться (в директорию logs)</span></div></font><div><span style="font-size:12.8px">Логгируются.</span></div><font color="#550055"><div><br></div><div>&gt;&nbsp;<span style="font-size:12.8px">а вот файл с задачей в sent если удалось отослать хотя бы один пуш. Если ошибка была на все токены из файла - в fail</span></div></font><div><span style="font-size:12.8px">Только хотел об этом сказать, как, собственно, определить, в sent или в fail? Теперь ясно как.</span></div><div><span style="font-size:12.8px"><br></span></div><div><br></div><div>Итого: все, что помечено словом "исправлю", я таки исправлю, а всё остальное - это уже дополнительные условия, отсутствующие в исходной задаче. Их я&nbsp;</div></div><div class="gmail_extra"><br><div class="gmail_quote">18 февраля 2016 г., 18:03 пользователь x2 <span dir="ltr">&lt;<a href="mailto:x2xert@gmail.com" target="_blank">x2xert@gmail.com</a>&gt;</span> написал:<div style="padding:5 0"><font size="1" color="#888888">[Цитируемый текст скрыт]</font></div></div><br></div>
</font></div></td></tr></tbody></table></td></tr></tbody></table></div></div><script type="text/javascript">// <![CDATA[
document.body.onload=function(){document.body.offsetHeight;window.print()};
// ]]></script><div></div></body></html>